# Nuwa Script Abstract Syntax Tree (AST) Specification

This document describes the structure of the Abstract Syntax Tree (AST) generated by parsing Nuwa Script code. The AST represents the syntactic structure of the code in a hierarchical format, suitable for interpretation or further analysis.

Each node in the AST has a `type` property indicating the kind of syntactic construct it represents.

## Node Types

### Base Nodes

*   **`Node`**: The base interface for all AST nodes.
*   **`Statement`**: Base interface for statement nodes.
*   **`Expression`**: Base interface for expression nodes.

### Root Node

*   **`Script`**
    *   `type: "Script"`
    *   `statements: Statement[]` - A list of top-level statements in the script.

### Statements

*   **`LetStatement`**
    *   `type: "LetStatement"`
    *   `variable: Variable` - The identifier node for the variable being declared.
    *   `value: Expression` - The expression whose result is assigned to the variable.
*   **`CallStatement`**
    *   `type: "CallStatement"`
    *   `toolName: Variable` - Identifier for the tool being called.
    *   `arguments: ObjectLiteral | null` - An object literal containing the arguments (key-value pairs), or null if no arguments.
*   **`IfStatement`**
    *   `type: "IfStatement"`
    *   `condition: Expression` - The expression evaluated for the condition.
    *   `thenBlock: Statement[]` - List of statements executed if the condition is true.
    *   `elseBlock: Statement[] | null` - Optional list of statements executed if the condition is false.
*   **`ForStatement`**
    *   `type: "ForStatement"`
    *   `iteratorVariable: Variable` - The identifier for the loop variable.
    *   `iterable: Expression` - The expression evaluating to the list/collection to iterate over.
    *   `loopBlock: Statement[]` - List of statements executed in each iteration.
*   **`ExpressionStatement`**
    *   `type: "ExpressionStatement"`
    *   `expression: Expression` - An expression used as a statement (e.g., a standalone `PRINT` call).

### Expressions

*   **`Literal`**
    *   `type: "Literal"`
    *   `value: string | number | boolean | null` - The literal value.
*   **`Variable`**
    *   `type: "Variable"`
    *   `name: string` - The name of the identifier.
*   **`BinaryOp`**
    *   `type: "BinaryOp"`
    *   `operator: string` - The binary operator token (e.g., `"+"`, `"=="`, `"AND"`).
    *   `left: Expression` - The left-hand side expression.
    *   `right: Expression` - The right-hand side expression.
*   **`UnaryOp`**
    *   `type: "UnaryOp"`
    *   `operator: string` - The unary operator token (e.g., `"NOT"`, `"-"`).
    *   `operand: Expression` - The expression the operator applies to.
*   **`FunctionCall`** (Built-in functions)
    *   `type: "FunctionCall"`
    *   `functionName: Variable` - Identifier for the built-in function (`PRINT`, `NOW`, `FORMAT`).
    *   `arguments: Expression[]` - List of argument expressions.
*   **`CallExpression`** (Tool calls as expressions)
    *   `type: "CallExpression"`
    *   `toolName: Variable` - Identifier for the tool being called.
    *   `arguments: ObjectLiteral | null` - An object literal containing the arguments, or null if no arguments.
*   **`CalcExpression`**
    *   `type: "CalcExpression"`
    *   `formula: Literal` - String literal containing the formula.
    *   `variables: ObjectLiteral` - Object literal containing variable substitutions.
*   **`MemberAccess`**
    *   `type: "MemberAccess"`
    *   `object: Expression` - The expression evaluating to the object/structure.
    *   `property: Variable` - The identifier of the property being accessed.
*   **`ElementAccess`**
    *   `type: "ElementAccess"`
    *   `array: Expression` - The expression evaluating to the list/array.
    *   `index: Expression` - The expression evaluating to the numerical index.
*   **`ListLiteral`**
    *   `type: "ListLiteral"`
    *   `elements: Expression[]` - List of expressions representing the elements.
*   **`ObjectLiteral`**
    *   `type: "ObjectLiteral"`
    *   `properties: ObjectEntry[]` - List of key-value pairs.

### Helper Nodes

*   **`ObjectEntry`** (Used within `ObjectLiteral`)
    *   `type: "ObjectEntry"`
    *   `key: Variable | Literal` - The key (either an identifier or a string literal).
    *   `value: Expression` - The value expression.

This structure provides a comprehensive representation of the Nuwa Script code, enabling interpreters or other tools to understand and process it effectively.
