# Nuwa Identity Kit 测试指南

本指南介绍了如何运行 Nuwa Identity Kit 的测试套件。

## 测试结构

Nuwa Identity Kit 的测试被组织为以下几个主要模块：

1. **VDR 实现测试** - 测试了 VDR 抽象的各种实现
2. **核心功能测试** - 测试主类的功能
3. **权限模型测试** - 测试 NIP-1 权限模型
4. **集成测试** - 测试组件之间的协作

## 运行测试

### 先决条件

确保已安装所有必要的依赖项：

```bash
pnpm install
```

### 运行所有测试

执行以下命令运行所有测试：

```bash
pnpm test
```

### 带覆盖率报告的测试

使用以下命令生成覆盖率报告：

```bash
pnpm test:coverage
```

测试覆盖率报告将生成在 `coverage` 目录中。

### 观察模式

在开发过程中，您可能想使用 watch 模式来自动重新运行受影响的测试：

```bash
pnpm test:watch
```

## 测试助手

测试套件包括多个助手函数，用于创建测试数据和模拟依赖项。这些助手可以在 `test/helpers` 目录中找到：

- `testUtils.ts` - 包含用于 DID 文档和身份相关测试的辅助功能

## 编写新测试

编写新测试时，请遵循以下最佳实践：

1. **使用测试助手** - 尽可能使用提供的测试助手来创建测试数据
2. **测试边缘情况** - 确保测试覆盖正常流程和错误条件
3. **隔离测试** - 每个测试都应该独立，不依赖于其他测试的状态
4. **遵循测试模式** - 使用 `describe` 和 `it` 块来组织测试，提供清晰的描述

## 测试覆盖率目标

我们力求以下测试覆盖率目标：

- 分支覆盖率: 75%
- 函数覆盖率: 80%
- 行覆盖率: 85%
- 语句覆盖率: 85%

如果提交的代码没有达到这些目标，CI 流程可能会失败。确保在提交代码之前运行 `pnpm test:coverage` 并验证覆盖率。
