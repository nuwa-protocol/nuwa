---
title: "MCP Proxy"
description: "Turn an existing MCP into a pay‑per‑call service using the Nuwa MCP Server Proxy"
---

## What you'll build

Convert an existing MCP server (HTTP/stream or stdio) into a Nuwa‑compatible, pay‑per‑call service without changing the upstream code. The proxy exposes a single JSON‑RPC endpoint (`/mcp`) over streamable HTTP, forwards tools, and attaches Nuwa payment semantics.

<Note>
Use this when you already have an MCP server and want pricing and DID‑based authentication without refactoring the upstream.
</Note>

## Prerequisites

- Node.js 18+ and pnpm
- A Rooch RPC endpoint (testnet is fine)
- A Service key (ServiceDID) for settlement

## Quick start

<Steps>
<Step title="Install and build">

```bash
cd nuwa-services/mcp-server-proxy
pnpm install
pnpm build
```

</Step>

<Step title="Create a config.yaml">

```yaml
# Minimal proxy config
port: 8088
endpoint: "/mcp"

# Upstream MCP (http stream or stdio)
upstream:
  type: "httpStream"
  url: "https://api.example.com/mcp"
  # Optional auth to upstream
  # auth:
  #   scheme: "bearer"
  #   token: "${UPSTREAM_API_TOKEN}"

# Payment & network
serviceId: "my-mcp-service"
serviceKey: "${SERVICE_KEY}"
network: "test"
defaultPricePicoUSD: "100000000"   # 0.0001 USD
debug: false

# Optional per-tool pricing (overrides default)
register:
  tools:
    - name: "example.search"
      pricePicoUSD: "200000000"     # 0.0002 USD
```

</Step>

<Step title="Run the proxy">

```bash
export SERVICE_KEY=...          # required for settlement
export UPSTREAM_API_TOKEN=...   # if your upstream requires it

node dist/index.js --config ./config.yaml
# -> serves POST /mcp (JSON-RPC over streamable HTTP)
```

<Check>
Verify health and tools list via your MCP client (`initialize`, `tools/list`).
</Check>

</Step>
</Steps>

## Upstream modes

<Tabs>
<Tab title="httpStream">

```yaml
upstream:
  type: "httpStream"
  url: "https://api.example.com/mcp"
  auth:
    scheme: "bearer"
    token: "${UPSTREAM_API_TOKEN}"
```

</Tab>
<Tab title="stdio">

```yaml
upstream:
  type: "stdio"
  command: ["npx", "-y", "@vendor/your-mcp@latest"]
  env:
    API_KEY: "${UPSTREAM_API_KEY}"
```

</Tab>
</Tabs>

## Pricing and settlement

- Default price applies to all forwarded tools: `defaultPricePicoUSD`.
- Override specific tools via `register.tools[].pricePicoUSD`.
- Per‑call authorization and payment data are carried in reserved arguments merged into every tool schema:
  - `__nuwa_auth`: DIDAuth v1 header string
  - `__nuwa_payment`: serialized payment request payload
- Responses can include a payment resource frame alongside normal MCP `content`.

## Deployment

- Works well on Railway or any Node hosting. See repository scripts under `nuwa-services/mcp-server-proxy/deployments/` for templates.
- Use environment variables for secrets (`SERVICE_KEY`, upstream tokens).

## Preconfigured examples

Two ready-to-run examples are included in `nuwa-services/mcp-server-proxy`:

<Tabs>
<Tab title="Amap proxy (HTTP upstream)">

```bash
cd nuwa-services/mcp-server-proxy
export AMAP_API_KEY=your_amap_api_key_here
export SERVICE_KEY=your_service_key_here

# Optional: set a port (defaults in script)
export PORT=8088

./examples/run-amap-local.sh
# → Serves /mcp on http://localhost:8088
```

Config reference: `deployments/instances/amap-proxy/config.yaml`

</Tab>

<Tab title="Context7 proxy (stdio upstream)">

```bash
cd nuwa-services/mcp-server-proxy
export SERVICE_KEY=your_service_key_here

# Optional: set a port (defaults in script)
export PORT=8089

./examples/run-context7-local.sh
# → Serves /mcp on http://localhost:8089
```

Config reference: `deployments/instances/context7-proxy/config.yaml`

</Tab>
</Tabs>

## When to use the proxy vs a custom server

- **Proxy**: you already have an MCP, need pricing quickly, and prefer zero upstream changes.
- **Custom server**: you want first‑class control, custom tool logic, or richer validation; see the native server guide.

<CardGroup cols={3}>
  <Card title="Native MCP server (with Payment Kit)" icon="bolt" href="/build-caps/mcp-server">
    Build a pay‑per‑call MCP server directly using the Payment Kit.
  </Card>
  <Card title="MCP overview" icon="book" href="/build-caps/mcp">
    Conceptual overview and selection guide.
  </Card>
  <Card title="MCP Client" icon="bolt" href="/build-caps/mcp-client">
    Initialize, call tools, stream, and recover channels.
  </Card>
</CardGroup>


