---
title: "Wallet & Payment"
description: "About Wallet & Payment in Nuwa"
---
## Overview

Nuwa uses crypto micropayments so users can pay developers directly for model and tool usage. Payments are fast, low-overhead, and work for both request/response and streaming APIs.

Under the hood, Nuwa implements unidirectional payment channels (NIP-4) with Rooch on-chain settlement:

- Off-chain receipts (SubRAV) are exchanged per request or stream chunk
- Receipts are signed by the payer's DID key and later claimable by the service
- Channels can be topped up, recovered, and closed cooperatively

## How It Works

- Identity: Each request carries DIDAuth v1 (NIP-2) proving who is paying
- Channel state: Each request includes `X-Payment-Channel-Data` with the latest signed SubRAV
- Settlement: Services batch-claim on chain using Rooch contracts when economical

Both HTTP and MCP transports are supported, including SSE/NDJSON streams where payment frames are injected in-band.

## Client Integration (HTTP)

Use `@nuwa-ai/payment-kit` to automatically manage channels and attach payment headers:

```ts
import { IdentityKit } from '@nuwa-ai/identity-kit';
import { createHttpClient } from '@nuwa-ai/payment-kit';

const env = await IdentityKit.bootstrap({
  method: 'rooch',
  vdrOptions: { rpcUrl: 'https://test-seed.rooch.network', network: 'test' },
});

const http = await createHttpClient({
  baseUrl: 'http://localhost:3003',
  env,
  maxAmount: 1_000_000_000n, // per-request budget in asset units
});

const { data, payment } = await http.get('/echo?message=hello');
console.log(payment?.cost?.toString());
```

## MCP Integration

For Model Context Protocol tools, the same payment channel primitives are available. The Nuwa client includes a payer-side MCP client; services can opt-in using the server adapter:

```ts
// Server
import { createFastMcpServer } from '@nuwa-ai/payment-kit/mcp';
const app = await createFastMcpServer({ /* declare free & paid tools */ });
await app.start();

// Client
import { PaymentChannelMcpClient } from '@nuwa-ai/payment-kit/mcp';
const client = new PaymentChannelMcpClient({ baseUrl: 'http://localhost:8080/mcp', signer });
const result = await client.call('analyze', { data: '...' });
```

See SDK -> Payment Kit for full strategies (per-request, per-token), streaming, recovery, and storage.

## Wallets & Assets

Nuwa channels currently settle on Rooch using BCS-encoded receipts. Assets are identified by `assetId` (e.g., `0x3::gas_coin::RGas`). The client can manage deposits, sub-channel authorization for multiple devices, and cooperative close.

<Note>
  Custodial onboarding flows are available via CADOP (see Identity). You can start with a passkey and still pay cryptographically from your DID.
</Note>
